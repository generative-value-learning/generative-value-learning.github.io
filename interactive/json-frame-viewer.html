<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frame Viewer</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .upload-container {
            text-align: center;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .viewer-container {
            display: none;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .frame-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .frame-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        .frame-info {
            flex: 1;
        }
        .frame-image {
            flex: 2;
            text-align: center;
        }
        .frame-image img {
            max-width: 100%;
            max-height: 500px;
        }
        .plot-container {
            flex: 1;
            min-height: 400px;
        }
        button {
            padding: 8px 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        button:hover:not(:disabled) {
            background-color: #0056b3;
        }
        .error {
            color: red;
            padding: 10px;
            display: none;
        }
        .frame-slider {
            flex-grow: 1;
            margin: 0 10px;
        }
        input[type="range"] {
            width: 100%;
        }
        #frameCounter {
            min-width: 100px;
            text-align: center;
        }
        select {
            padding: 8px;
            font-size: 16px;
            width: 80%;
            max-width: 800px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="upload-container">
        <select id="fileSelect">
            <option value="">Select a task...</option>
            <optgroup label="ALOHA">
                <option value="overhead_cam_banana-handover_example1_final_v0_094b179a00e040ed9f9cc86ba421dc75.json">Banana Handover</option>
                <option value="overhead_cam_bowl-in-rack_example1_final_v0_5fe3095ba41c4a96821b82246c645dba.json">Bowl in Rack</option>
                <option value="overhead_cam_close-laptop_example1_final_v0_86a41504e3d743d5a2d88cee8f56f4ad.json">Close Laptop</option>
                <option value="overhead_cam_close-shoe-box_example1_final_v0_685ad66222ee48bcb35f3187a58bc8d1.json">Close Shoe Box</option>
                <option value="overhead_cam_cup-in-rack_example1_final_v0_9872b1d9ede44f36a2a4c9f186ae7d0c.json">Cup in Rack</option>
                <option value="overhead_cam_fold-dress_example1_final_v0_9941d5afca634d8ca01ba9193c89d3bd.json">Fold Dress</option>
                <option value="overhead_cam_open-drawer_example1_final_v0_2e363929301c45048c2ea6b41091fbd0.json">Open Drawer</option>
                <option value="overhead_cam_open-jar-lid_example1_final_v0_ed10a6b475594a50b93891319a90add7.json">Open Jar Lid</option>
                <option value="overhead_cam_open-laptop_example1_final_v0_4db1cfde5c5f4ee6a4f0631071674627.json">Open Laptop</option>
                <option value="overhead_cam_pen-handover_example1_final_v0_8473b68671fd454ebdebaeaaa9d30450.json">Pen Handover</option>
                <option value="overhead_cam_remove-gears_example1_final_v0_fac3d4152e8c413d90965dd1d34a6d73.json">Remove Gears</option>
                <option value="overhead_cam_shirt-handover_example1_final_v0_00b7ef3064d349fdbd73af409f4ec7e1.json">Shirt Handover</option>
                <option value="overhead_cam_take-phone-out_example1_final_v0_ba709af37ecd4b9a9975dab1892b1c46.json">Take Phone Out</option>
            </optgroup>
            <optgroup label="Navigation">
                <option value="room_tour2_44338c3d2c084431bf3925be1bf93328.json">Room Tour 2</option>
                <option value="room_tour_b8f0c28f53dc43e7b25482f098542d63.json">Room Tour</option>
            </optgroup>
            <optgroup label="OXE">
                <option value="oxe_asu_table_top_converted_externally_to_rlds_d123568799a74ae8a560afbb838ef993.json">ASU Table Top</option>
                <option value="oxe_austin_buds_dataset_converted_externally_to_rlds_ef14a1f717fd4bffba0d758576d92536.json">Austin BUDS</option>
                <option value="oxe_austin_sirius_dataset_converted_externally_to_rlds_b19a67c401a841d1b14e0f6e1a130b9e.json">Austin SIRIUS</option>
                <option value="oxe_bc_z_9ecdcf5770cc4593a569a3544b61fea6.json">BC-Z</option>
                <option value="oxe_berkeley_autolab_ur5_0bffc7ea6b054bd6b399ea97fdea57e4.json">Berkeley AutoLab UR5</option>
                <option value="oxe_berkeley_cable_routing_3cebff37baf64967ba63f3716b4e0f29.json">Berkeley Cable Routing</option>
                <option value="oxe_berkeley_fanuc_manipulation_a127bc641a24499ca17a7b426f38f00a.json">Berkeley Fanuc</option>
                <option value="oxe_berkeley_mvp_converted_externally_to_rlds_38d63a2a4b434c0cbd748d05cfea84dc.json">Berkeley MVP</option>
                <option value="oxe_berkeley_rpt_converted_externally_to_rlds_18b7367cfb9844598445462262d99e35.json">Berkeley RPT</option>
                <option value="oxe_bridge_7e677d2df9984442a19104fb8044f5f2.json">Bridge</option>
                <option value="oxe_cmu_play_fusion_6477220ebec548adaf838ca5dfa6602d.json">CMU Play Fusion</option>
                <option value="oxe_cmu_stretch_92c23b249e794ef4bd0784059b871e49.json">CMU Stretch</option>
                <option value="oxe_dlr_edan_shared_control_converted_externally_to_rlds_e99323c4ab1a41aa97ce1be25172e34d.json">DLR EDAN</option>
                <option value="oxe_dlr_sara_pour_converted_externally_to_rlds_799e048a6a5e4a7982edbd1fad2032d8.json">DLR SARA Pour</option>
                <option value="oxe_dobbe_5e1a20bb6a364139a046d5244fda4bd2.json">Dobbe</option>
                <option value="oxe_droid_100_438dde61efa04aee9eadeb5cff2b0b2b.json">DROID 100</option>
                <option value="oxe_droid_897f2c92bce74f549d8ab503ee06541b.json">DROID</option>
                <option value="oxe_fmb_81f44d51aea24962ba73837fad990b5b.json">FMB</option>
                <option value="oxe_fractal20220817_data_e8d709ea19834225b7bac3cd9af788a4.json">Fractal</option>
                <option value="oxe_iamlab_cmu_pickup_insert_converted_externally_to_rlds_c5f6f8058ec74b62b033fb63efe1a9e1.json">IAMLab CMU</option>
                <option value="oxe_imperialcollege_sawyer_wrist_cam_752a9ae7d5974b88955c400a1f6b7375.json">Imperial College Sawyer</option>
                <option value="oxe_jaco_play_e16e479b8a9a427c92e9d7170aa42d75.json">JACO Play</option>
                <option value="oxe_maniskill_dataset_converted_externally_to_rlds_63b0b56442384103aa4470282ec8e3a2.json">ManiSkill</option>
                <option value="oxe_nyu_door_opening_surprising_effectiveness_b3c748268df64a00b025dba01d276e96.json">NYU Door Opening</option>
                <option value="oxe_nyu_franka_play_dataset_converted_externally_to_rlds_40de759083104e42a9424a29502a865b.json">NYU Franka Play</option>
                <option value="oxe_roboturk_96c2423c11f041e5ab3b5b2649fbfca3.json">RoboTurk</option>
                <option value="oxe_stanford_hydra_dataset_converted_externally_to_rlds_143061fde9db4ec5ab64776aa941f3e5.json">Stanford Hydra</option>
                <option value="oxe_stanford_mask_vit_converted_externally_to_rlds_ba0befcee5434edf84a70eb3404286c8.json">Stanford Mask ViT</option>
                <option value="oxe_stanford_robocook_converted_externally_to_rlds_6581bdc1393d473eb27867f069ba523a.json">Stanford RoboCook</option>
                <option value="oxe_taco_play_ee2c546299b04613872a374168541fc9.json">TACO Play</option>
                <option value="oxe_tokyo_u_lsmo_converted_externally_to_rlds_fec4d32be2e74e5d8457dd00c039248a.json">Tokyo U LSMO</option>
                <option value="oxe_toto_45d71bdbb7ec44d5ac0041c44dc9ddab.json">TOTO</option>
                <option value="oxe_ucsd_kitchen_dataset_converted_externally_to_rlds_671ae80caf26431094b363cb018c9ba4.json">UCSD Kitchen</option>
                <option value="oxe_ucsd_pick_and_place_dataset_converted_externally_to_rlds_12a95ac6f6844808a224d56f5a307d92.json">UCSD Pick and Place</option>
                <option value="oxe_uiuc_d3field_1a993d1570e543e290213a4f8536d969.json">UIUC D3Field</option>
                <option value="oxe_usc_cloth_sim_converted_externally_to_rlds_b16d6456485e4122953289aea735e929.json">USC Cloth Sim</option>
                <option value="oxe_utaustin_mutex_098f63ea0a4a49608dbea8ba46121fe8.json">UT Austin MUTEX</option>
                <option value="oxe_utokyo_pr2_opening_fridge_converted_externally_to_rlds_8b1f970903564437b0279875bee84575.json">UTokyo PR2 Fridge</option>
                <option value="oxe_utokyo_pr2_tabletop_manipulation_converted_externally_to_rlds_4f21dc7e3d0d434eaf3fb5b6c2fa7e26.json">UTokyo PR2 Tabletop</option>
                <option value="oxe_utokyo_xarm_bimanual_converted_externally_to_rlds_837ec94b39d0445d87fbb794611bbcdd.json">UTokyo xArm Bimanual</option>
                <option value="oxe_utokyo_xarm_pick_and_place_converted_externally_to_rlds_974a5ff9a39f4f59ad584d1039d821a9.json">UTokyo xArm Pick and Place</option>
                <option value="oxe_viola_6ae6db639a3340c2a5d284a9cd8a0fa6.json">VIOLA</option>
            </optgroup>
        </select>
        <div id="error" class="error"></div>
    </div>

    <div id="viewer" class="viewer-container">
        <div class="frame-navigation">
            <span id="frameCounter"></span>
            <div class="frame-slider">
                <input type="range" id="frameSlider" min="0" max="0" value="0">
            </div>
            <button id="playButton">Play</button>
        </div>

        <div class="frame-container">
            <div class="frame-info">
                <p style="display: none;"><strong>Frame ID:</strong> <span id="frameId"></span></p>
                <p style="display: none;"><strong>Number:</strong> <span id="frameNumber"></span></p>
                <p style="display: none;"><strong>Order:</strong> <span id="frameOrder"></span></p>
                <p style="height: 3em; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; cursor: pointer; transition: background-color 0.2s;" onmouseover="this.style.height='auto'; this.style.overflow='visible'; this.style['-webkit-line-clamp']='none'; this.style.backgroundColor='#f0f0f0';" onmouseout="this.style.height='3em'; this.style.overflow='hidden'; this.style['-webkit-line-clamp']='2'; this.style.backgroundColor='transparent';"><strong>Description:</strong> <span id="frameDescription"></span></p>
                <div class="frame-image">
                    <img id="frameImage" alt="Frame">
                </div>
            </div>
            <div id="plotContainer" class="plot-container"></div>
        </div>
    </div>

    <script>
        let currentData = null;
        let currentFrameIndex = 0;
        let playInterval = null;

        document.getElementById('fileSelect').addEventListener('change', handleFileSelect);
        document.getElementById('frameSlider').addEventListener('input', handleSliderChange);
        document.getElementById('playButton').addEventListener('click', togglePlay);

        function handleSliderChange(event) {
            currentFrameIndex = parseInt(event.target.value);
            updateView();
            updatePlot();
        }

        function handleFileSelect(event) {
            const filename = event.target.value;
            if (!filename) return;

            fetch(filename)
                .then(response => response.json())
                .then(json => {
                    validateAndLoadData(json);
                })
                .catch(error => {
                    showError('Error loading file');
                });
        }

        function validateAndLoadData(json) {
            if (!json.task_description || !json.task_id || !Array.isArray(json.frames)) {
                showError('Invalid JSON structure');
                return;
            }

            currentData = json;
            currentFrameIndex = 0;
            document.getElementById('viewer').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            
            // Update slider max value
            const slider = document.getElementById('frameSlider');
            slider.max = currentData.frames.length - 1;
            slider.value = 0;
            
            updateView();
            createPlot();
        }

        function togglePlay() {
            const playButton = document.getElementById('playButton');
            if (playInterval) {
                clearInterval(playInterval);
                playInterval = null;
                playButton.textContent = 'Play';
            } else {
                playButton.textContent = 'Pause';
                playInterval = setInterval(() => {
                    if (currentFrameIndex === currentData.frames.length - 1) {
                        clearInterval(playInterval);
                        playInterval = null;
                        playButton.textContent = 'Play';
                        return;
                    }
                    currentFrameIndex++;
                    document.getElementById('frameSlider').value = currentFrameIndex;
                    updateView();
                    updatePlot();
                }, 333); // 3 FPS = 333ms per frame
            }
        }
        function createPlot() {
            const frameIds = currentData.frames.slice(0, currentFrameIndex + 1).map(frame => frame.frame_id);
            const numbers = currentData.frames.slice(0, currentFrameIndex + 1).map(frame => frame.number);

            const trace = {
                x: frameIds,
                y: numbers,
                mode: 'lines+markers',
                type: 'scatter',
                name: 'Task Progress'
            };

            const layout = {
                title: 'Task Progress Over Frames',
                xaxis: {
                    title: 'Ground truth frame order',
                    range: [0, currentData.frames.length]
                },
                yaxis: {
                    title: 'Gemini Predicted Value Function',
                    range: [0, 100]
                }
            };

            Plotly.newPlot('plotContainer', [trace], layout);
        }

        function updatePlot() {
            const frameIds = currentData.frames.slice(0, currentFrameIndex + 1).map(frame => frame.frame_id);
            const numbers = currentData.frames.slice(0, currentFrameIndex + 1).map(frame => frame.number);

            const trace = {
                x: frameIds,
                y: numbers,
                mode: 'lines+markers',
                type: 'scatter',
                name: 'Task Progress'
            };
            const layout = {
                title: 'Task Progress Over Frames',
                xaxis: {
                    title: 'Ground truth frame order',
                    range: [0, currentData.frames.length]
                },
                yaxis: {
                    title: 'Gemini Predicted Value Function', 
                    range: [0, 100]
                }
            };

            Plotly.react('plotContainer', [trace], layout);
        }

        function updateView() {
            if (!currentData) return;

            // Update frame counter
            document.getElementById('frameCounter').textContent = 
                `Frame ${currentFrameIndex + 1} of ${currentData.frames.length}`;

            // Update frame information
            const frame = currentData.frames[currentFrameIndex];
            document.getElementById('frameId').textContent = frame.frame_id;
            document.getElementById('frameNumber').textContent = frame.number;
            document.getElementById('frameOrder').textContent = frame.frame_order;
            document.getElementById('frameDescription').textContent = frame.frame_description;
            document.getElementById('frameImage').src = frame.frame;
        }

        function showError(message) {
            const errorElement = document.getElementById('error');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            document.getElementById('viewer').style.display = 'none';
        }
    </script>
</body>
</html>
